{%- assign limit = section.settings.grid | times: section.settings.rows -%}

{%- capture image_size -%}{{section.settings.thumb-size}}{%- endcapture -%}

{% paginate collection.products by 50 %}

{% assign show_tags = false %}
{% if section.settings.tags_enable %}
   {% if collection.tags.size > 0 %}  
      {% assign show_tags = true %}
   {% endif %}
{% endif %}

{% assign show_coll_image = false %}
{% if section.settings.show_collection_image and collection.image %}
   {% assign show_coll_image = true %}
{% endif %}
<style>

  .bundle-builder-app--bundle--alert--content {
    background: rgba(0, 0, 0, 0.88);
    box-shadow: 0 0 0 1px rgb(63 63 68 / 5%), 0 1px 3px 0 rgb(63 63 68 / 15%);
    border-radius: 3px;
    color: #ffffff;
    padding: 0.8rem 1.6rem;
    text-align: center;
    bottom: 80px;
    position: fixed;
    z-index: 99999;
}
  .bundle-builder-app--bundle--alert--content.step2 {
    display: none;
  }

</style>
<div class="collection-wrap clearfix{% if show_tags %} show-sidebar{% endif %}" data-section-id="{{ section.id }}" data-section-type="collection-template">

   <h1 class="page-title">{{collection.title|escape}}{% if current_tags %}<small> {{ 'collections.tags.tagged_as' | t }} "{{current_tags.first | capitalize}}"</small>{% endif %}</h1>

   {% if collection.description != blank or show_coll_image %}
      <div id="collection-desc" class="clearfix{% if settings.mobile_hide_coll_desc %} hide-mobile{% endif %}">
         {% if show_coll_image %}
            <img class="coll-img {{section.settings.collection_image_align}}" src="{{ collection.image.src | collection_img_url: 'large'}}" alt="{{collection.title | escape}}" />
         {% endif %}
         {% if collection.description != blank %}
        	<div class="coll-desc">
               {{collection.description}}
            </div>
         {% endif %}
      </div>
   {% endif %}

   {% if show_tags or section.settings.sort_enable %}  
      <div class="sort-and-filter{% if section.settings.sort_enable %} show-sort{% endif %}">
         <nav class="coll-tags show-tags clearfix">
            {% unless collection.handle == '7bap-signature-series' %}
  {% include 'sort-by' %}
{% endunless %}  
            {% if show_tags %}
               <a class="button" href="#">{{ 'collections.tags.title' | t }}</a>    
            {% endif %}
         </nav>  

         {% if show_tags and collection.products.size > 0 %}
            {% if collection.handle == "all" %}  
               {% capture coll_url %}/collections/all{% endcapture%}
            {% else %}
               {% capture coll_url %}{{collection.url}}{% endcapture%}
            {% endif %}
            <div class="tags">
               <a class="{% unless current_tags %}current{% endunless %}" href="{{coll_url}}">{{ 'collections.tags.view_all' | t }}</a>
               {% for tag in collection.all_tags %}
                  {%- if tag contains '_HIDDEN_PRODUCT' -%}{%- continue -%}{%- endif -%}
                  <a class="{% if current_tags contains tag %}current{% endif %}" href="{{coll_url}}/{{tag | handle}}">{{ tag }}</a>
               {% endfor %}    
            </div>
         {% endif %}   
      </div>
   {% endif %}  
  
   <div class="collection-main">   
      {% if collection.products.size < 1 %}
        <p>{{'collections.general.no_matches' | t}}</p>
      {% endif %}
      <ul class="block-grid collection-th columns{{section.settings.grid}} flexbox-grid">  
         {% for product in collection.products %}
            {% include 'bundle-product-loop', grid_image_width: image_size %}
         {% endfor %}
      </ul>

      {% if paginate.pages > 1 %}
         {% include 'pagination' %}
      {% endif %}
   </div>
<div class="bundle-builder-app--bundle--alert--content step2">
  <span>There are <span class="bundle-total-quantity">0</span> products in your bundle.</span>
  Your bundle is ready.
  <button class="" name="add" id="addToCartBundleButton">   
      <span>
          Add to Cart
      </span>
  </button>
</div>
<div class="bundle-builder-app--bundle--alert--content step1">
  <div>
    <div class="bundle-builder-app--bundle--error-message">
      <div><span>Your bundle must contain at least 12 products.</span></div>
    </div>
    <span class="bundle-builder-app--number-of-products">
      <span>There are <span class="bundle-total-quantity">0</span> products in your bundle.</span> 
    </span>
  </div>
</div>
</div>

{% endpaginate %}



{% schema %}
  {
    "name": "Collection pages",
    "settings": [
      {
        "type": "select",
        "id": "thumb-size",
        "label": "Image size",
        "default": "200x200",
        "options": [
          {
            "value": "120x120",
            "label": "Small"
          },
          {
            "value": "200x200",
            "label": "Medium"
          },
          {
            "value": "400x400",
            "label": "Large"
          }
        ]
      },
      {
        "type": "select",
        "id": "grid",
        "label": "Products per row",
        "default": "3",
        "options": [
          {
            "value": "2",
            "label": "2"
          },
          {
            "value": "3",
            "label": "3"
          },
          {
            "value": "4",
            "label": "4"
          },
          {
            "value": "5",
            "label": "5"
          }
        ]
      },
      {
        "type": "select",
        "id": "rows",
        "label": "Rows per page",
        "default": "6",
        "options": [
          {
            "value": "3",
            "label": "3"
          },
          {
            "value": "4",
            "label": "4"
          },
          {
            "value": "5",
            "label": "5"
          },
          {
            "value": "6",
            "label": "6"
          },
          {
            "value": "7",
            "label": "7"
          },
          {
            "value": "8",
            "label": "8"
          },
          {
            "value": "9",
            "label": "9"
          },
          {
            "value": "10",
            "label": "10"
          }
        ]
      },

      {
        "type": "checkbox",
        "id": "show_sale_sticker",
        "label": "Show sale sticker",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_vendor",
        "label": "Show vendor",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "mobile_hide_coll_desc",
        "label": "Hide collection description on mobile"
      },
      {
        "type": "checkbox",
        "id": "sort_enable",
        "label": "Enable sorting",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "tags_enable",
        "label": "Enable tag filtering",
        "default": true
      },
     {
        "type": "header",
        "content": "Collection image"
      },
      {
        "type": "checkbox",
        "id": "show_collection_image",
        "label": "Show collection image",
        "default": true
      },
      {
        "type": "select",
        "id": "collection_image_align",
        "label": "Alignment",
        "default": "align-left",
        "options": [
          {
            "value": "align-none",
            "label": "Top"
          },
          {
            "value": "align-left",
            "label": "Left"
          },
          {
            "value": "align-right",
            "label": "Right"
          }
        ]
      }
    ]
  }
{% endschema %}
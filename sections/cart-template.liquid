{{ 'cart.scss' | asset_url | stylesheet_tag }} 
<style>
  .refTag {
    border-radius: 4px;
    background-color: rgba(113,113,113,0.11);
    color: #717171;
    font-size: 0.85714em;
    padding: 0.85714em;
    overflow: hidden;
  }
  .ref_text {
    padding: 0 10px;
    color: #323232;
    font-size: 1.14286em;
    font-weight: 500;
  }
  .referral-code .btn__icon {
    display: none;
  }
  #ref {
    margin-top:50px;
    background-color: white;
    color: #333333;
    background-clip: padding-box;
    border-radius: 5px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    width: 100%;
    padding: opx;
    word-break: normal;
    flex:0.9;
  }
	.vl {
	border-left: 1px solid #e5e5e5;
    height: 50px;
    margin-top: 50px;
	}

    #ref-input {
    background-color: white;
    color: #333333;
    border: 1px #d5d5d5 solid;
    background-clip: padding-box;
    border-radius: 5px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    width: 100%;
    padding: 0.92857em 0.78571em;
    word-break: normal;
  }
  .refferal_container {
    display:flex;
    justify-content:space-between;
  }
  .referral_code {
    background-color: white;
    color: #333333;
    border: 1px #d5d5d5 solid;
    background-clip: padding-box;
    border-radius: 5px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    width: 100%;
    padding: 0.92857em 0.78571em;
    word-break: normal;
   
  }
  #ref-input:focus {
    border-color: #693c97 !important;
    box-shadow: 0 0 0 1px #693c97 !important;  
  }
    #ref-input:focus ~ .apply_button{
	background:#693c97 !important;
    color:white;
    opacity:1;
  }
	.apply_button {
	padding-top: 0px;
    padding-bottom: 0px;
    margin-left: 0.85714em;
    background: #c8c8c8;
    background-color: #c8c8c8;
    opacity: .65;
    padding: 15px 20px;
    border-radius: 5px;
    display: inline-block;
    margin-bottom: 0;
    font-weight: 400;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
    white-space: nowrap;
    padding: 15px 25px;
    font-size: 14px;
    line-height: 1.42857143;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
   -moz-appearance: none;
  }
  	input::placeholder,textarea::placeholder{color:#737373 !important;}
  
	input::-webkit-input-placeholder{color:#737373 !important;}
  
   .btn.clear-cart {
    padding-top: 0px;
    padding-bottom: 0px;
    margin-left: 0.85714em;
    background: #c8c8c8;
    background-color: #c8c8c8;
    opacity: .65;
    padding: 15px 10px;
    border-radius: 5px;
    color:black;
     border: 1px solid #c8c8c8;
         -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
   -moz-appearance: none;
}
  .btn.clear-cart:hover {
    background: #ffb8b8 !important;
    float: right;
    color: red;
    opacity:1;
}
  .popover {
    display: block;
  }
  .hideMe {
    display: none;
  }
  .tooltips {
    width: 90%;
    background-color: black;
    color: #fff;
    border-radius: 5px;
    padding: 10px;
    position: absolute;
    top: 5px;
    left: 40px;
    z-index: 1;
  }  
  .fa-window-close:before, .fa-times:before {
      padding-left: 100p;
      position: absolute;
      top: 12px;
      right: 10px;
	}
  .fas.fa-exclamation-circle {
    padding-right: 10px;
  }
  .detail .close {
    position: absolute;
    top: 40px;
    right: 5px;
    font-size: 14px;
  }
  .detail {
    font-size: 14px;
  }
  .order-summary__section ~ .order-summary__section {
    border-top: none!important;
   }
  .order-summary__section.order-summary__section--discount {
    border-top: 1px solid rgba(175,175,175,0.34)!important;
  }
  .field.referral-code {
    border-bottom: 1px solid rgba(175,175,175,0.34)!important;
    margin-bottom: 20px;
  }
  #main-header {
    outline: none;
  }
  .alert-info {
    background-color: #f1f2f2;
    border-color: #d1d3d4;
    color: #717171;
 }
  @media (max-width: 749px) {
    .btn {
        width: auto;
    }
  }
 @media (max-width: 550px){ 
    .tooltips {
      width: 85%;
      font-size: 12px;
    }
   .detail {
    font-size: 12px;
   }
   .apply {
     display:none;
   }
   .referral-code .btn__icon {
      display: block;
    }
  
  }
  @media (max-width: 450px){ 
  .tooltips {
      width: 85%;
  }
   .refferal_container{
     flex-direction:column;
   }
	.vl {
		display:none;
	}
    .btn.clear-cart {
    width:100% !important;
    }
  }

  .mobile__container__refcode,
  .mobile__container__refcode .refferal_container {
    display: none;
  }
  
  .desktop__container__refcode {
    display: block;
  }
  
  @media screen and (max-width: 30em) {
    .template-cart .entry-content .shopping-cart .cart-form table tbody td.product-thumbnail img {
      max-width: 45px;
      max-height: 45px;
    }
  }
  
  @media screen and (max-width: 450px) {
    .mobile__container__refcode,
    .mobile__container__refcode .refferal_container{
      display: block;
    }
    .desktop__container__refcode {
      display: none;
    }
  }
</style>  

<div data-section-id="{{ section.id }}" data-section-type="cart-template">
  <div id="primary" class="content-area">
    {%- include 'page-header' -%}
    <div id="content" class="site-content">
      <div style="padding: 0 .625rem 0 1.2rem;" class="row">
        <div class="large-12 columns">
          <div class="entry-content">

            <!-- Custom code block -->
            {% if customer.tags contains "Distributor" %}
			    <h3><a href="/pages/bulk-order-form">Click here for Quick Order Form</a></h3>
    	<br>
          <!-- End code block -->
    {% endif %}
            {%- if cart.item_count > 0 -%}
              {% assign items = cart.items %}
              {% assign new_shirt = items | where: "id", 41621739307181 | first%}

            <form action="/cart" method="post" class="shopping-cart">
              <div class="cart-form">
                <table class="shop_table shop_table_responsive cart">
                  <thead>
                    <tr>
                      <th class="product-remove">&nbsp;</th>
                      <th class="product-thumbnail">&nbsp;</th>
                      <th class="product-name">{{ 'cart.label.product' | t }} this hit</th>
                      <th class="product-price">{{ 'cart.label.price' | t }}</th>
                      <th class="product-quantity">{{ 'cart.label.quantity' | t }}</th>
                      <th class="product-subtotal">{{ 'cart.label.total' | t }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {%- for item in cart.items -%}
                    <tr class="cart_item">
                      <td class="product-remove">
                <a href="/cart/change?line={{ forloop.index }}&amp;quantity=0" class="remove" title="{{ 'cart.general.remove' | t | escape }}"><span class="remove">Ã—</span></a>
                      </td>
                      <td class="product-thumbnail">
                        <a href="{{ item.url | within: collections.all }}">
                          {% if item.product.type  == 'Shorts'  %}
                                <img src={{ item.product.images[1] | img_url: '150x150' }} alt={{item.title}} srcset="{{ item.product.images[1] | img_url: '150x150', crop: 'center' }} 150w, {{ item.product.images[1] | img_url: '235x235', crop: 'center'  }} 235w, {{ item.product.images[1] | img_url: '768x768', crop: 'center'  }} 768w" sizes="(max-width: 150px) 100vw, 150px" >
                            {% else %}
                                  <img src="{{ item | img_url: '150x150', crop: 'center' }}" alt="" srcset="{{ item | img_url: '150x150', crop: 'center' }} 150w, {{ item | img_url: '235x235', crop: 'center'  }} 235w, {{ item | img_url: '768x768', crop: 'center'  }} 768w" sizes="(max-width: 150px) 100vw, 150px" />
                          {% endif %}	
                        </a>
                      </td>
                      <td class="product-name">
                        <div class="item_title">
                           <a href="{{ item.url | within: collections.all }}">{{ item.product.title }}</a>						                     
                          <!-- Custom Code -->
                         {%- for discount in item.discounts -%}
                        	<div class="item_discount">{{ discount.title }}</div>
                         {%- endfor -%}
                          
                          {% if item.product.compare_at_price and item.discounts == blank%}
                          {% assign calculated_value = item.price | times: 1.0 | divided_by: item.product.compare_at_price  | times: 100 %}
                          <div class="item_discount">Sale Price: {{ 100 | minus: calculated_value | round }}% OFF </div>
                          {% endif %}
                          <!-- End Custom Code -->
                          
                        </div>
                       {%- assign property_size = item.properties | size -%}
                        {%- if property_size > 0 -%}
                          {%- for p in item.properties -%}
                              {% if p.first contains '_Sale'%}
                                <div><a href="/pages/shipping-returns#return-exchange" style="color:red"> {{- p.last -}}</a></div>
                              {%- endif -%}
                            {% endfor %}
                        {% endif %}
                        <div class="cart_meta">
                          <dl style="color: red;" class="variation">
                            {% assign tags = item.product.tags | join: ", " %}
                            {% if tags contains 'limit' %}
                            {%- for tag in item.product.tags -%}
                            {% if tag contains 'limit' %}  
                            <dt>Limit:</dt>
                            <dd><span> {{ tag | remove: "limit" }}</span></dd>
                            {% endif %}
                            {% endfor %}  
                            {% endif %}
                          </dl>
                        </div>
                        {%- unless item.variant.title contains 'Default' -%}
                        <div class="cart_meta">
                          <dl class="variation">
                            {%- for option in item.product.options -%}
                            <dt>{{ option }}:</dt>
                            <dd><span>{{ item.variant.options[forloop.index0] }}</span></dd>
                            {%- endfor -%}
                          </dl>
                        </div>
                        {%- endunless -%}
                        {%- assign property_size = item.properties | size -%}
                        {%- if property_size > 0 -%}
                        <div class="cart_meta">
                          {%- for p in item.properties -%}
                            {%- unless p.last == blank or p.first contains '_Sale' -%}
                              {%- if p.last contains '/uploads/' -%}
                                <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                              {%- else -%}
                                {{- p.last -}}
                              {%- endif -%}
                            {%- endunless -%}
                          {%- endfor -%}
                        </div>
                      {%- endif -%}
                      </td>
                      <td class="product-price">
                        <div style="display: flex; align-items:center: justify-content:center">
                          {% if item.product.compare_at_price and item.discounts == blank%}
                          <span class="price-old money">{{item.product.compare_at_price | money }}</span>
                          {% endif %}
                        	<div class="price-old"> {% if item.original_price != item.price %} {{ item.original_price | money }} {% endif %}</div> <span>{{ item.price | money }} {% for discount in item.discounts %} {% endfor %}</span>
                        </div>                   
                        
                      </td>
                      <td class="product-quantity">
     
                                 <!-- Custom Code -->
                       <div class="quantity cartQty">
                          <span class="prodMinus"><i class="fa fa-minus" aria-hidden="true"></i></span>
                            <input id="updates_{{ item.key }}" onfocus="this.select()" data-line="{{ forloop.index }}" data-id="{{item.variant_id}}" data-url="{{item.url}}" type="number"  step="1" min="0" name="updates[]" value="{{ item.quantity }}" title="{{ 'cart.label.quantity' | t }}" type="tel" onClick="this.setSelectionRange(0, this.value.length)" class="input-text qty text cart" size="4" pattern="[0-9]*" />
                          <span class="prodPlus"><i class="fa fa-plus" aria-hidden="true"></i></span>
                            <!-- End Custom Code -->
                        </div>
                      </td>
                      <td class="product-subtotal">
                        <span class="amount money">{{ item.line_price | money }}</span>
                      </td>
                    </tr>
                    {%- endfor -%}
                  </tbody>
                </table>
                <div>
                <div class="cart-note">
                  <div class="minimal-form-input {% if cart.note != '' %}has{% else %}no{% endif %}-text">
                    <label for="cart-note">
                      <span class="text"><span class="text-inner">{{ 'cart.general.note' | t }}</span></span>
                    </label>
                    <input type="text" name="note" id="cart-note" class="input-text" value="{{ cart.note }}" />
                  </div>
                </div>
              </div> 
            <div class="desktop__container__refcode">    
            {% if customer.tags contains "distributor" or customer.tags contains "Distributor" %}
                <div style="margin-top:50px; margin-left:-10px;">
              		<a href="/cart/clear" class="btn clear-cart" style="float:right;">Clear Cart</a> 
                </div>
            {% else %}
              <div class='refferal_container'>
              <div id="ref">
                  <div style="display: flex;">
                      <input id="ref-input" placeholder="Enter Referral Code Here!" type="text" size="30" class="referral_code" val="referral code">
                      <input type="hidden" id="ref_code" name="attributes[Ref_CODE]" hidden type="text" value="{{ cart.attributes["Ref_CODE"] }}">
                      <input type="hidden" id="ref_id" name="attributes[Ref_ID]" hidden type="text" value="{{ cart.attributes["Ref_ID"] }}">
                      <a href='#' class="apply_button">
                          Apply
                      </a>
                  </div>
                 <p class="message" style="padding-top: 1px;"></p>
              </div>
                <div class="vl"></div>
                <div style="margin-top:50px; margin-left:-10px;">
              		<a href="/cart/clear" class="btn clear-cart" style="float:right;">Clear Cart</a> 
                </div>
              </div>
			{% endif %}
            </div>  
              </div>
              <div class="cart-sidebar">
                <div class="cart-collaterals">
                  <div class="cart_totals">
                    <h2 class="total-title">{{ 'cart.general.cart_totals' | t }}</h2>
                    <table class="shop_table shop_table_responsive">
                      <tbody>
                       
                        
                        <tr class="cart-subtotal">
						  <!-- Custom Code -->
                          <span class="checkoutqty" > <strong>QUANTITY:</strong>  {{ cart.item_count }} {{ cart.item_count | pluralize: 'Item', 'Items' }}</span>
                          <span class="checkoutqty" > <strong>SUBTOTAL:</strong>  {{ cart.total_price | money }}</span>
                          <!-- End Custom Code -->
                        </tr>
                        
                        
                        {% if cart.total_discounts > 0 %}
                        <tr class="order-total">
                          <th>{{ 'cart.general.savings' | t }}</th>
                          <td>
                            <strong>
                              <span class="money amount">
                                {{ cart.total_discounts | money }}
                              </span>
                            </strong>
                          </td>
                        </tr>
                        {% endif %}
                        
                        
                      </tbody>
                    </table>
                  </div>
                  <div class="proceed-to-checkout">
                    <button type="submit" name="checkout" class="checkout-button button btn1 bshadow alt wc-forward" value="">
                      <span>{{ 'cart.general.checkout' | t }}</span>
                    </button>
                    {% if additional_checkout_buttons %}
                    <div class="additional-checkout-buttons">{{ content_for_additional_checkout_buttons }}</div>
                    {% endif %}
                  </div>
                </div>
                              <!--     Mobile Container     -->
              <div class="mobile__container__refcode">
              {% if customer.tags contains "distributor" or customer.tags contains "Distributor" %}
                  <div>
                  <a href="/cart/clear" class="btn clear-cart" style="float:right;">Clear Cart</a> 
                  </div>
                {% else %}
                  <div class='refferal_container'>
                    <div style="margin-top: 0;" id="ref">
                    <div style="display: flex;">
                    <input id="ref-input" placeholder="Enter Referral Code Here!" type="text" size="30" class="referral_code" val="referral code">
                    <a href='#' class="apply_button">
                    Apply
                    </a>
                    </div>
                    <p class="message" style="padding-top: 1px;"></p>
                  </div>
                  <div class="vl"></div>
                  <div>
                    <a href="/cart/clear" class="btn clear-cart" style="float:right;">Clear Cart</a> 
                  </div>
                  </div>
              {% endif %}
              </div> 
              <!--                -->
              </div>
            </form>
            {%- else -%}
            <div class="empty">
              <p>{{ 'cart.general.empty' | t }}</p>
            </div>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script type="text/javascript">
   $.ajax({
      type: 'POST',
      url: '/cart/update.js',
     data:{"attributes[pagination]":'' , "attributes[tag]":''},
    success: function(cart){
      console.log(cart);
    },
    cache: false,
      dataType: 'json'
  });
  
   ref_CODE = $('#ref_code').val(); 
  if(ref_CODE) {
    setTimeout(function() { 
      if(ref_CODE) {   
        $('#ref .message').css('color','#00c4b3').append(`<p class="messText" style="margin: 10px 0px"><span class="refTag"><span><img src="https://img.icons8.com/material-sharp/24/000000/add-user-group-man-man.png"></span><span class="ref_text">${ref_CODE}</span><span class="cancel"><img src="https://img.icons8.com/material-rounded/24/000000/delete-sign.png" style="width:14px; cursor: pointer;"></span></span><span style="padding: 10px; color: #00c4b3">Success!</span></p>`);   
        $('.refMessage').text(``);
      }
    }, 2000);
  }
 $('.closeModal').on('click',function(){
   location.reload();
	
 });
  
 
 $(document).on('keyup keypress', 'form input[type="text"]', function(e) {
    if(e.which == 13) {
      e.preventDefault();
      return false;
    }
});
 $(document).on('click','.apply_button', function(e) {
      e.preventDefault();
	  let data = {};
      let api = '{{settings.sweetlegs_rocks_api}}';
      if($('.referral_code').val()) {
        data.refferal_code = $('.referral_code').val();
        console.log(data.refferal_code);
        $.ajax({
          type: 'GET',
          url: `${api}/api/distributor-rewards/referral-codes`,
          data: data,
          async: false,
          success: function(response) {
          if(response.referral_url) {
            let referralId = response.referral_url.slice(-8);
               var date = new Date();
               var minutes = 30;
               
              var params = {
                type: 'POST',
                url: '/cart/update.js',
                data: `attributes[Ref_ID]=${referralId}&attributes[Ref_CODE]=${data.refferal_code}`,
                dataType: 'json',
                success: function(response){
                  console.log('this hit response', response);
                  $('#ref_code').val($('.referral_code').val());
            	$('#ref_id').val(referralId);
                  	$('#ref .message').text('');
                    $('#ref .message').append(`<p class="messText" style="margin: 10px 0px"><span class="refTag"><span><img src="https://img.icons8.com/material-sharp/24/000000/add-user-group-man-man.png"></span><span class="ref_text">${$('.referral_code').val()}</span><span class="cancel"><img src="https://img.icons8.com/material-rounded/24/000000/delete-sign.png" style="width:14px; cursor: pointer;"></span></span><span style="padding: 10px; color: #00c4b3">Success!</span></p>`);
                    $('.refMessage').text(``).css({'color': '#00c4b3'});
                  	$('input.referral_code').css({ 'border': '1px #d5d5d5 solid','box-shadow':'none' });
                   $('.referral_code').val('');
                },
                error: function(XMLHttpRequest, textStatus) {
                    $('#ref .message').css('color','red').text('Something went wrong please try again.');
                	$('input.referral_code').css({ 'border': '1px solid red','box-shadow':'0 0 0 1px #ff6d6d' });
                    $('.refMessage').text(`Referred by a Distributor? Enter their code above!`).css('color', 'black');
                }
              }
              jQuery.ajax(params);
            
            } else {
                $('#ref .message').css('color','red').text('Please Enter A Valid Referral Code');
            	$('input.referral_code').css({ 'border': '1px solid red','box-shadow':'0 0 0 1px #ff6d6d' });
                $('.refMessage').text(`Referred by a Distributor? Enter their code above!`).css('color', 'black');
            }
          },
          error: function(error) {
            Cookies.remove('ref_ID'); 
            Cookies.remove('ref_CODE'); 
            $('#ref .message').css('color','red').text('Please Enter A Valid Referral Code');
            $('input.referral_code').css({ 'border': '1px solid red','box-shadow':'0 0 0 1px #ff6d6d' });
            $('.refMessage').text(`Referred by a Distributor? Enter their code above!`).css('color', 'black');
          }        
        });
        e.preventDefault();
      }

    });
  $(document).on('click', '.cancel', function(e) {
      Cookies.remove('ref_ID'); 
      Cookies.remove('ref_CODE'); 
      $('#ref_code').val('');
      $('#ref_id').val('');
      $('.refMessage').text(`Referred by a Distributor? Enter their code above!`).css('color', 'black');
      $('.message .messText').remove(); 
  });
   $(document).on('input', '.referral_code',function(e) {
      if($('.referral_code').val()) {
        $('.apply_button').css('background', '#693c91');
        $('.apply_button').css('opacity', '1');
        $('.apply_button').css('color', 'white');

      } else {
        $('.btn.apply_button').css('background', '#c8c8c8');
      }
      
    });
</script>

{% schema %}
  {
    "name": "Cart page",
    "settings": [
      {
        "type": "select",
        "id": "cart_notes",
        "label": "Cart notes",
        "options": [
          {
            "label": "Disable",
            "value": ""
          },
          {
            "label": "Enable",
            "value": "1"
          }
        ]
      }
    ]
  }
{% endschema %}

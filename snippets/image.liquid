{%- liquid
  assign img_url = image | img_url: '1x1' | replace: '_1x1.', '_{width}x.'
  assign aspect_ratio = image.aspect_ratio
  assign padding_top = 100 | divided_by: aspect_ratio | append: "%"

  if id == blank or id == ''
    assign id = image.id
  endif
-%}

<div class="image js-enabled {% unless disable_style %}image--{{ id }} {% endunless %}{{ wrapper_class }}">
  <img
    class="image__img lazyload{% if preload %} lazypreload{% endif %} {{ image_class }}"
    src="{{ image | img_url: '300x300' }}"
    data-src="{{ img_url }}"
    data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
    data-aspectratio="{{ aspect_ratio }}"
    data-sizes="auto"
    alt="{{ image.alt | escape }}"
  >
</div>

{%- unless disable_style -%}
  <style>
    #shopify-section-{{ section.id }} .image--{{ id }} {
      {% if max_height and image.height > max_height %}
        padding-top: {{ max_height }}px;
      {% else %}
        padding-top: {{ padding_top }};
      {% endif %}
    }
  </style>
{%- endunless -%}

<noscript>
  <div class="image image--{{ id }} {{ wrapper_class }}">
    <img class="image__img" src="{{ image | img_url: '2048x2048' }}" alt="{{ image.alt | escape }}">
  </div>
</noscript>
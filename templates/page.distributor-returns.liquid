<div id="primary" class="content-area">
  {%- include 'page-header' -%}
  <div id="content" class="site-content">
    <article class="page">
      <div class="row">
        <div class="large-12 columns">
          <div class="entry-content">
            {%- include 'shortcode' load: page.content -%} 
            <h4 class="rma_no" style="text-align: right"></h4>
             <table class="return shop-table">
                <thead>
                  <tr>
                    <th>ORDER#</th>
                    <th>IMAGE</th>
                    <th>NAME</th>
                    <th>QTY</th>
                    <th>PRICE</th>
                    <th>REASON</th>
                    <th>STATUS</th>
                  </tr>
                </thead>
                <tbody>
               </tbody>
              </table>
            <div class="calculation">
               <div class="row subTotal">
                  <div class="large-12 columns">
                    <span style="padding-right: 5px">SUBTOTAL:</span>$<span class="subTotalPrice"></span>  
                    </div>
                </div>
                <div class="row total">  
                  <div class="large-12 columns">
                    <span style="padding-right: 5px">TOTAL:</span>$<span class="totalPrice"></span> 
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </div>
</div>
<style>
  .distributor-return-iframe {
    width: 100%;
    height: 1000px;
    border: none;
  }
  .calculation {
    margin-top: 20px;
    font-weight: bold;
  }
  .return th {
    text-align: left!important;
    padding: 0px 10px;
  }
   @media (max-width: 540px){
    .entry-content {
      overflow: auto;
      padding-left: 20px;
    }
     table {
       max-width: 150%;
       width: 150%;
     }     
   }
</style>

<script>
  function calculateTotalPrice(total) {
    console.log(total);
        subTotal = 0;
        totalTax = {};
        $(".return tbody tr").each(function(){
         quantity = parseFloat($(this).find('.approve-quantity').text());
         subTotal = subTotal + parseFloat($(this).find('.approve-quantity').text()) * parseFloat($(this).find('.price-per-item').text());
         lineItemPrice = $(this).find('.price-per-item').text();
         taxes = JSON.parse($(this).find('.price-per-item').attr('data-taxes'));
        })
        $('.subTotalPrice').text(subTotal.toFixed(2));
        $('.totalPrice').text(total.toFixed(2));
    }
  $(document).ready(function(e) {
    let proxy = '{{settings.sweetlegs_rocks_api}}'

    let refundID = window.location.href.split("$").pop(); 
    let customerId = {}
    customerId.customerId = '{{customer.id}}';
    
    console.log(customerId);
     $.ajax({
       url: `${proxy}/api/distributor-returns/${refundID}`,
         type: 'get',
       	data: customerId,
         success: function (result) {
 
           refund = result.refund;
           refund.distributor_refund_line_items.forEach(function(returnLineItem){
             $('.return tbody').append(`<tr>
				  <td style="font-weight: bold">${returnLineItem.order_name}</td>
                  <td><img style="height:50px" src="${returnLineItem.variant.product.image_url}" /></td>
                  <td>${returnLineItem.variant.title === 'Default Title' ? returnLineItem.variant.product.title : (returnLineItem.variant.product.title + '/' + returnLineItem.variant.title) }</td>
                  <td><span class="approve-quantity">${returnLineItem.approved_quantity  !== null ? returnLineItem.approved_quantity :'1'}</span></td>
				  <td><span class="price-per-item" data-taxes='${JSON.stringify(returnLineItem.taxes)}'>${returnLineItem.approved_price ? returnLineItem.approved_price : returnLineItem.requested_price }</span></td>
				  <td>${returnLineItem.return_reason ? returnLineItem.return_reason : ''}</td>
				  <td>${refund.status}</td>
              </tr>`)
           }) 
             calculateTotalPrice(result.total);
         },
     });
  });
</script>
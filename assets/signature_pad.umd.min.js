/*!
 * Signature Pad v4.0.0 | https://github.com/szimek/signature_pad
 * (c) 2021 Szymon Nowak | Released under the MIT license
 */ !function(b,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(b="undefined"!=typeof globalThis?globalThis:b||self).SignaturePad=a()}(this,function(){"use strict";class b{constructor(a,b,c,d){if(isNaN(a)||isNaN(b))throw new Error(`Point is invalid: (${a}, ${b})`);this.x=+a,this.y=+b,this.pressure=c||0,this.time=d||Date.now()}distanceTo(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))}equals(a){return this.x===a.x&&this.y===a.y&&this.pressure===a.pressure&&this.time===a.time}velocityFrom(a){return this.time!==a.time?this.distanceTo(a)/(this.time-a.time):0}}class c{constructor(a,b,c,d,e,f){this.startPoint=a,this.control2=b,this.control1=c,this.endPoint=d,this.startWidth=e,this.endWidth=f}static fromPoints(a,b){let d=this.calculateControlPoints(a[0],a[1],a[2]).c2,e=this.calculateControlPoints(a[1],a[2],a[3]).c1;return new c(a[1],d,e,a[2],b.start,b.end)}static calculateControlPoints(c,a,d){let g=c.x-a.x,h=c.y-a.y,i=a.x-d.x,j=a.y-d.y,k=(c.x+a.x)/2,l=(c.y+a.y)/2,e=(a.x+d.x)/2,f=(a.y+d.y)/2,m=Math.sqrt(i*i+j*j),n=m/(Math.sqrt(g*g+h*h)+m),o=a.x-(e+(k-e)*n),p=a.y-(f+(l-f)*n);return{c1:new b(k+o,l+p),c2:new b(e+o,f+p)}}length(){let b,c,d=0;for(let a=0;a<=10;a+=1){let e=a/10,f=this.point(e,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),g=this.point(e,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(a>0){let h=f-b,i=g-c;d+=Math.sqrt(h*h+i*i)}b=f,c=g}return d}point(a,b,c,d,e){return b*(1-a)*(1-a)*(1-a)+3*c*(1-a)*(1-a)*a+3*d*(1-a)*a*a+e*a*a*a}}class a extends EventTarget{constructor(c,b={}){super(),this.canvas=c,this.options=b,this._handleMouseDown=a=>{1===a.buttons&&(this._drawningStroke=!0,this._strokeBegin(a))},this._handleMouseMove=a=>{this._drawningStroke&&this._strokeMoveUpdate(a)},this._handleMouseUp=a=>{1===a.buttons&&this._drawningStroke&&(this._drawningStroke=!1,this._strokeEnd(a))},this._handleTouchStart=a=>{if(a.preventDefault(),1===a.targetTouches.length){let b=a.changedTouches[0];this._strokeBegin(b)}},this._handleTouchMove=a=>{a.preventDefault();let b=a.targetTouches[0];this._strokeMoveUpdate(b)},this._handleTouchEnd=a=>{if(a.target===this.canvas){a.preventDefault();let b=a.changedTouches[0];this._strokeEnd(b)}},this._handlePointerStart=a=>{this._drawningStroke=!0,a.preventDefault(),this._strokeBegin(a)},this._handlePointerMove=a=>{this._drawningStroke&&(a.preventDefault(),this._strokeMoveUpdate(a))},this._handlePointerEnd=a=>{this._drawningStroke=!1,a.target===this.canvas&&(a.preventDefault(),this._strokeEnd(a))},this.velocityFilterWeight=b.velocityFilterWeight||.7,this.minWidth=b.minWidth||.5,this.maxWidth=b.maxWidth||2.5,this.throttle="throttle"in b?b.throttle:16,this.minDistance="minDistance"in b?b.minDistance:5,this.dotSize=b.dotSize||0,this.penColor=b.penColor||"black",this.backgroundColor=b.backgroundColor||"rgba(0,0,0,0)",this._strokeMoveUpdate=this.throttle?function(a,b=250){let c,d,e,f=0,g=null,h=()=>{f=Date.now(),g=null,c=a.apply(d,e),g||(d=null,e=[])};return function(...k){let j=Date.now(),i=b-(j-f);return d=this,e=k,i<=0||i>b?(g&&(clearTimeout(g),g=null),f=j,c=a.apply(d,e),g||(d=null,e=[])):g||(g=window.setTimeout(h,i)),c}}(a.prototype._strokeUpdate,this.throttle):a.prototype._strokeUpdate,this._ctx=c.getContext("2d"),this.clear(),this.on()}clear(){let{_ctx:b,canvas:a}=this;b.fillStyle=this.backgroundColor,b.clearRect(0,0,a.width,a.height),b.fillRect(0,0,a.width,a.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(a,b={}){return new Promise((e,f)=>{let c=new Image,d=b.ratio||window.devicePixelRatio||1,g=b.width||this.canvas.width/d,h=b.height||this.canvas.height/d,i=b.xOffset||0,j=b.yOffset||0;this._reset(),c.onload=()=>{this._ctx.drawImage(c,i,j,g,h),e()},c.onerror=a=>{f(a)},c.crossOrigin="anonymous",c.src=a,this._isEmpty=!1})}toDataURL(a="image/png",b){return"image/svg+xml"===a?this._toSVG():this.canvas.toDataURL(a,b)}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerStart),this.canvas.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerEnd),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(a,{clear:b=!0}={}){b&&this.clear(),this._fromData(a,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=b?a:this._data.concat(a)}toData(){return this._data}_strokeBegin(a){this.dispatchEvent(new CustomEvent("beginStroke",{detail:a}));let b={dotSize:this.dotSize,minWidth:this.minWidth,maxWidth:this.maxWidth,penColor:this.penColor,points:[]};this._data.push(b),this._reset(),this._strokeUpdate(a)}_strokeUpdate(a){if(0===this._data.length)return void this._strokeBegin(a);this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:a}));let k=a.clientX,l=a.clientY,m=void 0!==a.pressure?a.pressure:void 0!==a.force?a.force:0,b=this._createPoint(k,l,m),e=this._data[this._data.length-1],d=e.points,c=d.length>0&&d[d.length-1],n=!!c&&b.distanceTo(c)<=this.minDistance,{penColor:f,dotSize:g,minWidth:h,maxWidth:i}=e;if(!c||!c||!n){let j=this._addPoint(b);c?j&&this._drawCurve(j,{penColor:f,dotSize:g,minWidth:h,maxWidth:i}):this._drawDot(b,{penColor:f,dotSize:g,minWidth:h,maxWidth:i}),d.push({time:b.time,x:b.x,y:b.y,pressure:b.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:a}))}_strokeEnd(a){this._strokeUpdate(a),this.dispatchEvent(new CustomEvent("endStroke",{detail:a}))}_handlePointerEvents(){this._drawningStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerStart),this.canvas.addEventListener("pointermove",this._handlePointerMove),document.addEventListener("pointerup",this._handlePointerEnd)}_handleMouseEvents(){this._drawningStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(c,d,e){let a=this.canvas.getBoundingClientRect();return new b(c-a.left,d-a.top,e,new Date().getTime())}_addPoint(b){let{_lastPoints:a}=this;if(a.push(b),a.length>2){3===a.length&&a.unshift(a[0]);let d=this._calculateCurveWidths(a[1],a[2]),e=c.fromPoints(a,d);return a.shift(),e}return null}_calculateCurveWidths(c,d){let a=this.velocityFilterWeight*d.velocityFrom(c)+(1-this.velocityFilterWeight)*this._lastVelocity,b=this._strokeWidth(a),e={end:b,start:this._lastWidth};return this._lastVelocity=a,this._lastWidth=b,e}_strokeWidth(a){return Math.max(this.maxWidth/(a+1),this.minWidth)}_drawCurveSegment(a,b,d){let c=this._ctx;c.moveTo(a,b),c.arc(a,b,d,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(a,k){let d=this._ctx,n=a.endWidth-a.startWidth,l=2*Math.ceil(a.length());d.beginPath(),d.fillStyle=k.penColor;for(let g=0;g<l;g+=1){let b=g/l,h=b*b,i=h*b,c=1-b,j=c*c,m=j*c,e=m*a.startPoint.x;e+=3*j*b*a.control1.x,e+=3*c*h*a.control2.x,e+=i*a.endPoint.x;let f=m*a.startPoint.y;f+=3*j*b*a.control1.y,f+=3*c*h*a.control2.y,f+=i*a.endPoint.y;let o=Math.min(a.startWidth+i*n,k.maxWidth);this._drawCurveSegment(e,f,o)}d.closePath(),d.fill()}_drawDot(c,a){let b=this._ctx,d=a.dotSize>0?a.dotSize:(a.minWidth+a.maxWidth)/2;b.beginPath(),this._drawCurveSegment(c.x,c.y,d),b.closePath(),b.fillStyle=a.penColor,b.fill()}_fromData(j,k,l){for(let m of j){let{penColor:e,dotSize:f,minWidth:g,maxWidth:h,points:a}=m;if(a.length>1)for(let c=0;c<a.length;c+=1){let d=a[c],n=new b(d.x,d.y,d.pressure,d.time);this.penColor=e,0===c&&this._reset();let i=this._addPoint(n);i&&k(i,{penColor:e,dotSize:f,minWidth:g,maxWidth:h})}else this._reset(),l(a[0],{penColor:e,dotSize:f,minWidth:g,maxWidth:h})}}_toSVG(){let g=this._data,e=Math.max(window.devicePixelRatio||1,1),h=this.canvas.width/e,i=this.canvas.height/e,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width",this.canvas.width.toString()),a.setAttribute("height",this.canvas.height.toString()),this._fromData(g,(b,{penColor:d})=>{let c=document.createElement("path");if(!(isNaN(b.control1.x)||isNaN(b.control1.y)||isNaN(b.control2.x)||isNaN(b.control2.y))){let e=`M ${b.startPoint.x.toFixed(3)},${b.startPoint.y.toFixed(3)} C ${b.control1.x.toFixed(3)},${b.control1.y.toFixed(3)} ${b.control2.x.toFixed(3)},${b.control2.y.toFixed(3)} ${b.endPoint.x.toFixed(3)},${b.endPoint.y.toFixed(3)}`;c.setAttribute("d",e),c.setAttribute("stroke-width",(2.25*b.endWidth).toFixed(3)),c.setAttribute("stroke",d),c.setAttribute("fill","none"),c.setAttribute("stroke-linecap","round"),a.appendChild(c)}},(c,{penColor:e,dotSize:d,minWidth:f,maxWidth:g})=>{let b=document.createElement("circle");b.setAttribute("r",(d>0?d:(f+g)/2).toString()),b.setAttribute("cx",c.x.toString()),b.setAttribute("cy",c.y.toString()),b.setAttribute("fill",e),a.appendChild(b)});let j=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 ${this.canvas.width} ${this.canvas.height}" width="${h}" height="${i}">`,b=a.innerHTML;if(void 0===b){let c=document.createElement("dummy"),f=a.childNodes;c.innerHTML="";for(let d=0;d<f.length;d+=1)c.appendChild(f[d].cloneNode(!0));b=c.innerHTML}return"data:image/svg+xml;base64,"+btoa(j+b+"</svg>")}}return a})